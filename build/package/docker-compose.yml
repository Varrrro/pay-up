version: "3.7"

services: 
    gateway:
        image: pay-up:gateway
        ports: 
            - "8080:8080"
        networks:
            - main
        depends_on:
            - rabbit
            - gmicro
            - tmicro

    gmicro:
        image: pay-up:gmicro
        networks: 
            - main
        depends_on: 
            - rabbit
            - db-gmicro

    tmicro:
        image: pay-up:tmicro
        networks: 
            - main
        depends_on: 
            - rabbit
            - db-tmicro

    rabbit:
        image: rabbitmq:3
        networks: 
            - main

    db-gmicro:
        image: postgres:12
        networks:
            - main
        environment:
            - POSTGRES_USER=gmicro
            - POSTGRES_PASSWORD=gmicro
            - POSTGRES_DB=gmicro

    db-tmicro:
        image: postgres:12
        networks:
            - main
        environment:
            - POSTGRES_USER=tmicro
            - POSTGRES_PASSWORD=tmicro
            - POSTGRES_DB=tmicro

networks:
    main:
        driver: bridge
